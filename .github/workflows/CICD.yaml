name: Deploy node-dev to cloud
on:
  workflow_dispatch:
    inputs:
      branch_name:
        description: "node-dev branch name"
        required: true
      env_name:
        description: "environment name"
        required: true

jobs:
  inject_secrets:
  environment: ${{ inputs.env_name }}
  steps:
    inject:
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v2

        - name: Inject secrets
          env:
            TF_BACKEND_CONF_FILE: ${{ secrets.TFBACKEND }}
            TF_VARS_FILE: ${{ env.TFVARS }}
          run: |
            echo $TF_BACKEND_CONF_FILE | base64 --decode > backend.conf
            cp backend.conf cloud-devops/terraform/image_gallery/backends/backend.conf
            cp backend.conf cloud-devios/terraform/node-dev/backends/backend.conf
            pwd
          
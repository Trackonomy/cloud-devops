apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: azure-{{ .Values.keyVaultName }}-wi
  namespace: {{ .Values.environment }}
spec:
  provider: azure
  secretObjects:
  - secretName: events-uni-batchsize
    type: Opaque
    data:
    - objectName: batchsize
      key: batchsize
  - secretName: events-uni-user
    type: Opaque
    data:
    - objectName: user
      key: user
  - secretName: events-uni-password
    type: Opaque
    data:
    - objectName: password
      key: password
  - secretName: events-uni-server
    type: Opaque
    data:
    - objectName: server
      key: server
  - secretName: events-uni-database
    type: Opaque
    data:
    - objectName: database
      key: database
  - secretName: events-uni-schema
    type: Opaque
    data:
    - objectName: schema
      key: schema
  - secretName: events-uni-geteventsproc
    type: Opaque
    data:
    - objectName: geteventsproc
      key: geteventsproc
  - secretName: events-uni-msdiff
    type: Opaque
    data:
    - objectName: msdiff
      key: msdiff
  parameters:
    usePodIdentity: "false"
    useVMManagedIdentity: "true"
    userAssignedIdentityID: {{ .Values.managedUserAssignedIdentityId }}
    keyvaultName: {{ .Values.keyVaultName }}
    cloudName: ""
    objects: |
      array:
        - |
          objectName: BATCH-SIZE
          objectType: secret
          objectAlias: batchsize
          objectVersion: ""
        - |
          objectName: USER
          objectType: secret
          objectAlias: user
          objectVersion: ""
        - |
          objectName: PASSWORD
          objectType: secret
          objectAlias: password
          objectVersion: ""
        - |
          objectName: SERVER
          objectType: secret
          objectAlias: server
          objectVersion: ""
        - |
          objectName: DATABASE
          objectType: secret
          objectAlias: database
          objectVersion: ""
        - |
          objectName: SCHEMA
          objectType: secret
          objectAlias: schema
          objectVersion: ""
        - |
          objectName: GET-EVENTS-PROC
          objectType: secret
          objectAlias: geteventsproc
          objectVersion: ""
        - |
          objectName: MSDIFF
          objectType: secret
          objectAlias: msdiff
          objectVersion: ""
    tenantId: {{ .Values.identityTenant }}